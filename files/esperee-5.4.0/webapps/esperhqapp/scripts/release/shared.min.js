function ConfirmSharedController($scope){$scope.title=null;$scope.dialogClose=null;$scope.okButtonTitle="Ok";$scope.okButtonCallback=null;$scope.doInitialize=function(dialog){$scope.title=dialog.config.message;$scope.okButtonTitle=dialog.config.okButtonTitle;$scope.okButtonCallback=dialog.config.okButtonCallback;$scope.dialogClose=dialog.close;$scope.$apply()};$scope.doCancel=function(){$scope.dialogClose()};$scope.doOk=function(){$scope.dialogClose();if($scope.okButtonCallback!=null)$scope.okButtonCallback()}}
;function ErrorSharedController($scope){$scope.title=null;$scope.detail=null;$scope.type=null;$scope.dialogClose=null;$scope.displayDetail=false;$scope.details=null;$scope.doInitialize=function(dialog){$scope.type=dialog.config.type;if(dialog.config.hasOwnProperty("data")){$scope.title=null;if(dialog.config.data!=null&&dialog.config.data.hasOwnProperty("message"))$scope.title=dialog.config.data.message;if(!HQStringUtil.isPopulated($scope.title))$scope.title="Unexpection exception processing action, please check server logs";
$scope.details=null;if(dialog.config.data!=null&&dialog.config.data.hasOwnProperty("details"))$scope.details=dialog.config.data.details;if($scope.details!=null&&$scope.details.length>0)if($scope.details[0].exceptionClass==null)$scope.detail=$scope.details[0].exceptionMessage}else $scope.title=dialog.config.message;$scope.dialogClose=dialog.close;$scope.$apply()};$scope.doClose=function(){$scope.dialogClose()};$scope.doDoubleclickIcon=function(){$scope.displayDetail=true}};function FileSaveLoadController($scope,restService,dialogService){$scope.filetypes=[HQ_FILETYPE.ALL];$scope.dynatree=null;$scope.close=null;$scope.path=null;$scope.filename=null;$scope.mode=null;$scope.body=null;$scope.filetype=null;$scope.loadCallback=null;$scope.selectCallback=null;$scope.saveCallback=null;$scope.newfolder=false;$scope.newfolderName=null;$scope.dialogRootDOM=null;$scope.showDelete=false;$scope.selectedFolder=false;$scope.doInitialize=function(dialog){$scope.mode=dialog.config.mode;
$scope.filename=dialog.config.filename;$scope.body=dialog.config.body;$scope.filetype=dialog.config.filetype;$scope.filetypes.push($scope.filetype);$scope.loadCallback=dialog.config.loadCallback;$scope.selectCallback=dialog.config.selectCallback;$scope.saveCallback=dialog.config.saveCallback;var children=HQFileSystemUtil.getDirectoryFileDataArray(null,dialog.config.rootFolder.files);$scope.dialogRootDOM=dialog.root;var dynatreeRootDiv=HQJqueryUtil.findElementById(dialog.root,"filesaveload_tree");
dynatreeRootDiv.dynatree({onFocus:function(node){if(node.data.isFolder)$scope.path=node.data.absolutePath},onClick:function(node,event){if(node.data.isFolder){$scope.path=node.data.absolutePath;$scope.selectedFolder=true}else{$scope.path=node.data.containingFolderPath;$scope.filename=node.data.title;$scope.selectedFolder=false}$scope.showDelete=true;$scope.$apply()},onDblClick:function(node,event){if(node.isFolder||$scope.mode==HQ_FILEDIALOGOPTYPE.SAVE)return;$scope.path=node.data.containingFolderPath;
$scope.filename=node.data.title;if($scope.mode==HQ_FILEDIALOGOPTYPE.LOAD)$scope.doFileLoad();else $scope.doFileSelect();return true},debugLevel:0,children:[{title:"Project Files",isFolder:true,children:children}],onLazyRead:function(node){$scope.loadDirectoryNode(node)}});$scope.dynatree=dynatreeRootDiv.dynatree("getTree");children=$scope.dynatree.getRoot().getChildren();var rootFolder=children[0];rootFolder.expand(true);$scope.visitNodeVisibilityFilter(rootFolder);$scope.close=dialog.close;$scope.$apply()};
$scope.doDelete=function(){var file;if($scope.selectedFolder)file=$scope.path;else file=$scope.getCurrentPath();var deleteCB=function(){var cbDeleted=function(){$scope.doRefresh()};restService.deleteVFSFile(file,cbDeleted)};var type=$scope.selectedFolder?"folder":"file";var config={message:"Are you sure you want to delete "+type+" '"+file+"' ?",okButtonTitle:"Delete",okButtonCallback:deleteCB};dialogService.getOpenDialogCallback()(HQ_DIALOG.SHARED_CONFIRMALERT,config)};$scope.loadDirectoryNode=function(node){var cbFetched=
function(response){var childdata=HQFileSystemUtil.getDirectoryFileDataArray(node.data.absolutePath,response.files);if(childdata.length>0)node.addChild(childdata);else node.setLazyNodeStatus(DTNodeStatus_Ok);node.focus();$scope.visitNodeVisibilityFilter(node)};restService.fetchVFSItem(node.data.absolutePath,cbFetched)};$scope.visitNodeVisibilityFilter=function(node){var extension=$scope.filetype.extension;var f=function(node){if(node.data.isFolder)return true;if(extension==null){$(node.li).show();
return null}if(!HQStringUtil.endsWith(node.data.title,extension))$(node.li).hide();else $(node.li).show()};node.visit(f)};$scope.doHandleFiletype=function(){$scope.visitNodeVisibilityFilter($scope.dynatree.getRoot())};$scope.getCurrentPath=function(){var path=$scope.path;if(path==null)path=$scope.filename;else path+="/"+$scope.filename;return path};$scope.doFileSave=function(){if(!HQStringUtil.isPopulated($scope.filename))return;var path=$scope.getCurrentPath();if(path.indexOf(".",path)==-1)path+=
"."+$scope.filetype.extension;var cbDone=function(){dialogService.getIndexEventTarget().fire({type:HQ_EVENTTARGET_TYPE.FILESAVED.name});$scope.close();if($scope.saveCallback!=null)$scope.saveCallback(path)};restService.postVFSFile(path,{directory:false,body:$scope.body},cbDone)};$scope.doFileLoad=function(){var path=$scope.getCurrentPath();var cbFetched=function(file){if(file.directory)return;$scope.close();$scope.loadCallback({name:file.name,body:file.body})};restService.fetchVFSItem(path,cbFetched)};
$scope.doFileSelect=function(){var path=$scope.getCurrentPath();$scope.selectCallback(path);$scope.close()};$scope.doCancel=function(){$scope.close()};$scope.doNewFolder=function(){$scope.newfolder=true;$scope.newfolderName=null;var focusit=function(){$scope.dialogRootDOM.find("input.filesaveload_newfolder_input").focus()};setTimeout(focusit,100)};$scope.doRefresh=function(){HQFileSystemUtil.refreshFolders(restService,$scope.dynatree)};$scope.doOkNewFolder=function(){if(!HQStringUtil.isPopulated($scope.newfolderName))return;
var path=$scope.path;if(path==null)path=$scope.newfolderName;else path+="/"+$scope.newfolderName;var cbDone=function(){$scope.newfolder=false;var node=HQFileSystemUtil.findNodeByPath($scope.dynatree,$scope.path);if(node==null){console.log("Failed to refresh directory");return}var cbFetched=function(response){var childdata=HQFileSystemUtil.getDirectoryFileDataArray(node.data.absolutePath,response.files);HQFileSystemUtil.reconcileChildNodes(node,childdata);node.expand(true);$scope.visitNodeVisibilityFilter(node)};
restService.fetchVFSItem(node.data.absolutePath,cbFetched)};restService.postVFSFile(path,{directory:true},cbDone)}};function IndexFileMenuController($scope,restService,dialogService){$scope.dynatreeRootDiv=null;$scope.dynatreeRoot=null;$scope.path=null;$scope.filename=null;$scope.$dynatreeDiv=null;$scope.isLaunchable=false;$scope.isWizardable=false;$scope.isOpenable=false;$scope.isViewable=false;$scope.isDialogable=false;$scope.regressionDirExpanded=true;dialogService.getIndexEventTarget().addListener(HQ_EVENTTARGET_TYPE.FILESAVED.name,function(){$scope.doRefresh()});$("#index_resizable").resizable();$scope.$dynatreeDiv=
$("#index_filetree");$scope.$dynatreeDiv.dynatree({onFocus:function(node){if(node.data.isFolder)$scope.path=node.data.absolutePath},onClick:function(node,event){$scope.isOpenable=false;$scope.isLaunchable=false;$scope.isWizardable=false;$scope.isViewable=false;$scope.isDialogable=false;if(node.data.isFolder)$scope.path=node.data.absolutePath;else{$scope.path=node.data.containingFolderPath;$scope.filename=node.data.title;var isEventlet=HQStringUtil.endsWith($scope.filename,"."+HQ_FILETYPE.EVENTLET.extension);
var isHtml=HQStringUtil.endsWith($scope.filename,"."+HQ_FILETYPE.HTML.extension);$scope.isDialogable=HQStringUtil.endsWith($scope.filename,"."+HQ_FILETYPE.TRACE.extension);$scope.isViewable=!$scope.isDialogable;$scope.isLaunchable=isEventlet;$scope.isWizardable=isEventlet;$scope.isOpenable=isEventlet||isHtml}$scope.$apply()},onLazyRead:function(node){$scope.loadDirectoryNode(node)},debugLevel:0,children:[{title:"Project Files",isFolder:true,children:[]}]});$scope.loadDirectoryNode=function(node){var cbFetched=
function(response){var childdata=HQFileSystemUtil.getDirectoryFileDataArray(node.data.absolutePath,response.files);if(childdata.length>0)node.addChild(childdata);else node.setLazyNodeStatus(DTNodeStatus_Ok);node.focus();node.expand(true);if(!$scope.regressionDirExpanded){$scope.regressionDirExpanded=true;var regressionNode=HQFileSystemUtil.findNodeByPath($scope.$dynatreeDiv.dynatree("getTree"),"regression");if(regressionNode!=null)$scope.loadDirectoryNode(regressionNode)}};restService.fetchVFSItem(node.data.absolutePath,
cbFetched)};$scope.doRefresh=function(){HQFileSystemUtil.refreshFolders(restService,$scope.$dynatreeDiv.dynatree("getTree"))};$scope.doLaunch=function(){var cbFetched=function(file){if(file.directory)return;var eventletXml=file.body;var config={eventletName:file.name,eventletXml:eventletXml};dialogService.getOpenDialogCallback()(HQ_DIALOG.EVENTLET,config)};restService.fetchVFSItem($scope.getAbsolutePath(),cbFetched)};$scope.doWizard=function(){var cbHaveEventletObj=function(response){var config={eventlet:response};
dialogService.getOpenDialogCallback()(HQ_DIALOG.EVENTLETWIZARD,config)};var cbFetched=function(file){if(file.directory)return;restService.postEventletToJSON({xml:file.body},cbHaveEventletObj)};restService.fetchVFSItem($scope.getAbsolutePath(),cbFetched)};$scope.doOpenNewWindow=function(){var isEventlet=HQStringUtil.endsWith($scope.filename,"."+HQ_FILETYPE.EVENTLET.extension);var isHtml=HQStringUtil.endsWith($scope.filename,"."+HQ_FILETYPE.HTML.extension);var url;if(isEventlet){url=HQUriUtil.getUrlViews("launcher.html?"+
HQ_LAUNCHPARAMTYPE.EVENTLETFILENAME+"\x3d"+$scope.getAbsolutePath());HQWindowUtil.openNewWindowFullscreen(url,"Eventlet "+$scope.getAbsolutePath(),false)}else if(isHtml){url=HQUriUtil.getUrlViews("vfs/"+$scope.getAbsolutePath());HQWindowUtil.openNewWindowFullscreen(url,"Eventlet HTML "+$scope.getAbsolutePath(),false)}};$scope.doOpenDialog=function(){var isTrace=HQStringUtil.endsWith($scope.filename,"."+HQ_FILETYPE.TRACE.extension);if(isTrace){var config={trace:$scope.getAbsolutePath()};dialogService.getOpenDialogCallback()(HQ_DIALOG.DEBUGGER,
config)}};$scope.getAbsolutePath=function(){var path=$scope.path;if(path==null)path=$scope.filename;else path+="/"+$scope.filename;return path};$scope.doView=function(){var config={filepath:$scope.getAbsolutePath()};dialogService.getOpenDialogCallback()(HQ_DIALOG.SHARED_VIEWFILEBODY,config)};var loadConfig=function(){var root=$scope.$dynatreeDiv.dynatree("getRoot");var rootChild=root.getChildren()[0];$scope.loadDirectoryNode(rootChild)};$scope.envUpdateEventTarget.addListener(HQ_EVENTTARGET_TYPE.CONFIGLOADED.name,
loadConfig)};function IndexTopMenuController($scope){$scope.$parent.envUpdateEventTarget.addListener(HQ_EVENTTARGET_TYPE.INDEXENVUPDATE.name,function(){$scope.updateSelectables()});$scope.selectableEndpoints=[];$scope.choiceEndpoint=null;$scope.selectableEngines=[];$scope.choiceEngine=null;$scope.doTopMenuDialog=function(dialogEnum){if($scope.choiceEngine==null){alert("Please select an engine instance");return}$scope.$parent.doMenuDialog(dialogEnum)};$scope.doHandleChangeEngineURI=function(){$scope.$parent.doHandleSelectEndpointAndEngine($scope.choiceEndpoint,
$scope.choiceEngine)};$scope.doHandleChangeEndpoint=function(){$scope.selectableEngines=$scope.choiceEndpoint.engines;$scope.choiceEngine=HQEndpointUtil.getDefaultEngine($scope.selectableEngines);$scope.$parent.doHandleSelectEndpointAndEngine($scope.choiceEndpoint,$scope.choiceEngine)};$scope.updateSelectables=function(){$scope.selectableEndpoints=$scope.$parent.endpoints;$scope.selectableEngines=$scope.$parent.engineURIs;$scope.choiceEndpoint=HQEndpointUtil.getDefaultEndpoint($scope.selectableEndpoints);
if($scope.choiceEndpoint==null){$scope.selectableEngines=[];$scope.choiceEngine=null}else{$scope.selectableEngines=$scope.choiceEndpoint.engines;$scope.choiceEngine=HQEndpointUtil.getDefaultEngine($scope.selectableEngines)}};$scope.doHelp=function(){HQHelpDialogHelper.openHelp("connectivity")}};function LoginController($scope,restService){$scope.username=null;$scope.password=null;$scope.authenticatedCB=null;$scope.closeCB=null;$scope.loginerror=null;$scope.doInitialize=function(dialog){$scope.authenticatedCB=dialog.config.authenticated;$scope.closeCB=dialog.close};$scope.doLogin=function(){var cbSuccess=function(response){var sessionToken=response.sessionToken;HQCookieUtil.setUserCookie(sessionToken);$scope.closeCB();$scope.authenticatedCB()};var cbFailed=function(){$scope.loginerror="Invalid login information, the provided username and password could not be validated"};
restService.authenticate({username:$scope.username,password:$scope.password},cbFailed,cbSuccess)}};function MetricsSelectionSharedController($scope){$scope.metricstypes=[HQ_ENGINEMETRICS_TYPE.ENGINE,HQ_ENGINEMETRICS_TYPE.FILTER,HQ_ENGINEMETRICS_TYPE.STMTOUTPUT];var metricstablediv=HQJqueryUtil.findFirstChildElementUnderId($scope.parentRootDOM,"eventletwizard_resourceselect_metricsdiv");var metricstable=metricstablediv.dataTable(HQTableUtil.getDefaultPlainDatatableConfig({"bSort":false}));metricstable.find("tbody").click(function(event){$(metricstable.fnSettings().aoData).each(function(){$(this.nTr).removeClass("eventletwizard_row_selected")});
$(event.target.parentNode).addClass("eventletwizard_row_selected")});metricstable.delegate("tr","click",function(){var rownum=metricstable.fnGetPosition(this);if(rownum!=null)$scope.parentHandleMetricsSelect($scope.metricstypes[rownum])});var myarr=[];for(var i=0;i<$scope.metricstypes.length;i++){var row=$scope.metricstypes[i];myarr.push([row.title,row.description])}metricstable.fnClearTable();metricstable.fnAddData(myarr)};function StatementBrowseSharedController($scope,dialogService,restService){$scope.selectionExpr=null;$scope.statementTable=null;var tableConfig={"bAutoWidth":false,"aoColumns":[{"sWidth":"20%"},{"sWidth":"40%"},{"sWidth":"10%"},{"sWidth":"10%"},{"sWidth":"10%"},{"sWidth":"10%"}]};$scope.statementTable=HQJqueryUtil.findFirstChildElementUnderId($scope.parentRootDOM,"statements_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig(tableConfig));$scope.statementTable.delegate("tr","click",function(){var statementName=
$("td:first",this).text();if(HQStringUtil.isPopulated(statementName))$scope.$parent.parentHandleStatementSelect(statementName)});$scope.doGet=function(all){var handle=function(response){var myarr=[];for(var i=0;i<response.statements.length;i++){var row=response.statements[i];myarr.push([row["statementName"],HQStringUtil.surroundByPreTag(row["epl"]),HQStringUtil.emptyString(row["state"]),HQDateUtil.printDate(row["lastStateChange"]),HQStringUtil.emptyString(row["type"]),HQStringUtil.emptyString(row["description"])])}$scope.statementTable.fnClearTable();
$scope.statementTable.fnAddData(myarr)};var parent=$scope.$parent;restService.fetchStatements($scope.parentGetEndpointName(),$scope.parentGetEngineURI(),$scope.selectionExpr,all,false,handle)};$scope.doRefresh=function(){$scope.doGet(false)};$scope.doOpenCriteria=function(){var callback=function(expression){$scope.selectionExpr=expression;$scope.$apply()};dialogService.getOpenDialogCallback()(HQ_DIALOG.SHARED_STMTSELECTION,{okCallback:callback})};$scope.doHelp=function(){HQHelpDialogHelper.openHelp("enginemgmt-statementlist")};
$scope.doNew=function(){dialogService.getOpenDialogCallback()(HQ_DIALOG.STMTCREATE,{endpointName:$scope.endpointName,engineURI:$scope.engineURI})}};function StatementSelectionSharedController($scope){$scope.stringFilterChoices=[{name:"Equals",op:"\x3d"},{name:"Like",op:"like"},{name:"Regexp",op:"regexp"}];$scope.stateFilterChoices=[{name:"STARTED"},{name:"STOPPED"}];$scope.filter={choiceStmt:$scope.stringFilterChoices[0],choiceEPL:$scope.stringFilterChoices[0],choiceState:$scope.stateFilterChoices[0],choiceUO:$scope.stringFilterChoices[0],choiceTagName:$scope.stringFilterChoices[0],conjunction:"and",statementName:"",epl:"",userObject:"",tagName:"",
tagValue:""};$scope.dialogSelectionExpr="";$scope.requiredTagName=false;$scope.doAddNameCriteria=function(){addSelection($scope,"name "+$scope.filter.choiceStmt.op+" '"+$scope.filter.statementName+"'")};$scope.doAddEPLCriteria=function(){addSelection($scope,"epl "+$scope.filter.choiceEPL.op+" '"+$scope.filter.epl+"'")};$scope.doAddStateCriteria=function(){addSelection($scope,"state \x3d '"+$scope.filter.choiceState.name+"'")};$scope.doAddUOCriteria=function(){addSelection($scope,"userObject "+$scope.filter.choiceUO.op+
" '"+$scope.filter.userObject+"'")};$scope.doAddTagCriteria=function(){if(!HQStringUtil.isPopulated($scope.filter.tagName)){$scope.requiredTagName=true;return}$scope.requiredTagName=false;addSelection($scope,"tag('"+$scope.filter.tagName+"') "+$scope.filter.choiceTagName.op+" '"+$scope.filter.tagValue+"'")};$scope.doChangeSelectionExpr=function(){$scope.parentSetStatementSelectionExpression($scope.dialogSelectionExpr)};var addSelection=function($scope,textAdd){var withConjunction;if($scope.dialogSelectionExpr.trim()===
"")withConjunction=textAdd;else withConjunction=" "+$scope.filter.conjunction+" "+textAdd;$scope.dialogSelectionExpr=$scope.dialogSelectionExpr+withConjunction;$scope.doChangeSelectionExpr()}};function VariableSelectionSharedController($scope,restService){$scope.variables=[];$scope.variable=null;$scope.variableName="";$scope.variableErrorMsg=null;var cbFetched=function(response){$scope.variables=response.variables};restService.fetchVariables($scope.parentGetEndpointName(),$scope.parentGetEngineURI(),cbFetched);$scope.doRefresh=function(){restService.fetchVariables($scope.parentGetEndpointName(),$scope.parentGetEngineURI(),cbFetched)};$scope.doAdd=function(){$scope.variableErrorMsg=null;
var variableName=null;if(HQStringUtil.isPopulated($scope.variableName))variableName=$.trim($scope.variableName);else if($scope.variable!=null)variableName=$scope.variable.variableName;if(variableName!=null)$scope.parentHandleVariableSelect(variableName);else $scope.variableErrorMsg="Please select a variable first or enter the variable name"}};function ViewFileBodySharedController($scope){$scope.body=null;$scope.doInitialize=function(dialog){var $textarea=HQJqueryUtil.findElementById(dialog.root,"viewfilebody_textarea");if($textarea.parent().parent().height()>0){var heightContainer=Math.max(600,$textarea.parent().parent().height()-50);$textarea.css("height",heightContainer)}$scope.body=dialog.config.body;$scope.$apply()}};