function ConsumerBrowseController($scope,dialogService,restService){$scope.clientId=dialogService.getConsumerMgmtService().getClientId();if($scope.clientId==null)$scope.clientId="unallocated";$scope.subtopics=null;$scope.doInitialize=function(dialog){$scope.doRefresh();$scope.$apply()};$scope.doRefresh=function(){$scope.subtopics=getSubtopics(dialogService.getConsumerMgmtService())};$scope.doHelp=function(){HQHelpDialogHelper.openHelp("pushmonitoring-browser")};var getSubtopics=function(cms){var subtopicMap=
cms.getSubtopics();var subtopics=[];for(var subtopic in subtopicMap){if(!subtopicMap.hasOwnProperty(subtopic))continue;var consumerWrapper=subtopicMap[subtopic];var activationsMap=consumerWrapper.getActivations();var activations=[];for(var activationId in activationsMap){if(!activationsMap.hasOwnProperty(activationId))continue;var activation=activationsMap[activationId];var activationRow={activationId:activationId,activationName:activation.activationName,composition:getComposition(activation.composition)};
activations.push(activationRow)}var consumer=consumerWrapper.getConsumer();var consumerURL=null;var consumerState=null;if(consumer.getWebSocket()!=null){consumerURL=consumer.getWebSocket().url;var wsReadyState=consumer.getWebSocket().readyState;switch(wsReadyState){case 0:consumerState="connecting";break;case 1:consumerState="open";break;case 2:consumerState="closing";break;case 3:consumerState="closed";break;default:consumerState=""}}var row={subtopic:subtopic,consumerId:consumerWrapper.getConsumerId(),
consumerURL:consumerURL,consumerState:consumerState,consumerLogEntries:consumer.getLogEntries().reverse(),consumerMsgCount:consumer.getMsgCount(),activations:activations};subtopics.push(row)}return subtopics};var getComposition=function(composition){for(key in composition)if(composition.hasOwnProperty(key))return key}};function EventletWizardController($scope,dialogService,restService){$scope.vistypes=[HQ_EVENTLET_TYPE.CHART,HQ_EVENTLET_TYPE.GAUGE,HQ_EVENTLET_TYPE.GRID,HQ_EVENTLET_TYPE.PLUGIN,HQ_EVENTLET_TYPE.TIMELINE];$scope.endpoints=null;$scope.selectedEndpoint=null;$scope.selectedEngineURI=null;$scope.rootDOM=null;$scope.dialog=null;$scope.steps=["one","two","three"];$scope.step=0;$scope.stepAccessible=0;$scope.wizard={vistype:null,resources:[]};$scope.progress="";$scope.eventTargetConfiguration=new EventTarget;
$scope.eventTargetComputeComposition=new EventTarget;$scope.doInitialize=function(dialog){$scope.endpoints=dialog.config.endpoints;$scope.selectedEndpoint=dialog.config.selectedEndpoint;$scope.selectedEngineURI=dialog.config.selectedEngineURI;$scope.dialog=dialog;$scope.rootDOM=dialog.root;var vistypetablediv=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"eventletwizard_visualizationtype_div");var vistypetable=vistypetablediv.dataTable(HQTableUtil.getDefaultPlainDatatableConfig({"bSort":false}));
vistypetablediv.find("tbody").click(function(event){$(vistypetable.fnSettings().aoData).each(function(){$(this.nTr).removeClass("eventletwizard_row_selected")});$(event.target.parentNode).addClass("eventletwizard_row_selected")});vistypetable.delegate("tr","click",function(){var rownum=vistypetable.fnGetPosition(this);if(rownum!=null){$scope.wizard.vistype=$scope.vistypes[rownum];$scope.updateProgress();$scope.$apply()}});if(dialog.config.resource!=null)$scope.wizard.resources.push(dialog.config.resource);
if(dialog.config.eventlet!=null){$scope.stepAccessible=2;$scope.wizard.vistype=HQPushUtil.getCompositionEventletType(dialog.config.eventlet.composition);$scope.wizard.resources=dialog.config.eventlet.sources;$scope.wizard.composition=dialog.config.eventlet.composition;$scope.wizard.settings=dialog.config.eventlet.settings;$scope.updateProgress();var index=HQCollectionUtil.findValueInArray($scope.vistypes,$scope.wizard.vistype);var i=0;$(vistypetable.fnSettings().aoData).each(function(){$(this.nTr).removeClass("eventletwizard_row_selected");
if(i==index)$(this.nTr).addClass("eventletwizard_row_selected");i++})}else if(false){$scope.step=2;$scope.stepAccessible=2;$scope.wizard.vistype=HQ_EVENTLET_TYPE.PLUGIN;$scope.wizard.resources.push({statement:{name:"CHART_1",endpoint:"defaultendpoint",engineUri:"default"}});$scope.wizard.resources.push({statement:{name:"TIMELINE_1",endpoint:"defaultendpoint",engineUri:"default"}});$scope.updateProgress();var fireCompleteEvent=function(){$scope.eventTargetConfiguration.fire({type:HQ_EVENTTARGET_TYPE.EVENTLETWIZARDCONFIG.name})};
setTimeout(fireCompleteEvent,100)}};$scope.updateProgress=function(){$scope.progress="";if($scope.wizard.vistype!=null)$scope.progress=$scope.wizard.vistype.title;if($scope.wizard.resources.length!=0&&HQStringUtil.isPopulated($scope.progress)){$scope.progress+=" of ";if($scope.wizard.resources.length>1)$scope.progress+="Multiple Resources";else{var src=$scope.wizard.resources[0];var row=HQPushUtil.getResourceDetail(src);if(HQStringUtil.isPopulated(row.name))$scope.progress+=row.type+" "+row.name;
else $scope.progress+=row.type}}};$scope.isFirstStep=function(){return $scope.step===0};$scope.isLastStep=function(){return $scope.step===$scope.steps.length-1};$scope.isCurrentStep=function(step){return $scope.step===step};$scope.setCurrentStep=function(step){$scope.step=step;if(step==2)$scope.eventTargetConfiguration.fire({type:HQ_EVENTTARGET_TYPE.EVENTLETWIZARDCONFIG.name});$scope.updateProgress()};$scope.getCurrentStep=function(){return $scope.steps[$scope.step]};$scope.isStepAccessible=function(step){return $scope.stepAccessible>=
step};$scope.getNextLabel=function(){return $scope.isLastStep()?"Launch":"Next"};$scope.handlePrevious=function(){$scope.step-=$scope.isFirstStep()?0:1};$scope.doHandleNext=function(dismiss){if($scope.isLastStep()){$scope.eventTargetComputeComposition.fire({type:HQ_EVENTTARGET_TYPE.EVENTLETWIZARDCOMPOSITION.name});if(!$scope.validate())return;var openDialog=function(eventletXml){var config={eventletName:"Live capture",eventletXml:eventletXml};dialogService.getOpenDialogCallback()(HQ_DIALOG.EVENTLET,
config)};$scope.restCallEventletXML(openDialog)}else{$scope.step+=1;if($scope.step>$scope.stepAccessible)$scope.stepAccessible=$scope.step;$scope.updateProgress();if($scope.step==2)$scope.eventTargetConfiguration.fire({type:HQ_EVENTTARGET_TYPE.EVENTLETWIZARDCONFIG.name})}};$scope.doSave=function(){$scope.eventTargetComputeComposition.fire({type:HQ_EVENTTARGET_TYPE.EVENTLETWIZARDCOMPOSITION.name});if(!$scope.validate())return;var cbHaveXML=function(eventletXml){var filename=$scope.progress+"."+HQ_FILETYPE.EVENTLET.extension;
var saveConfig={filename:filename,mode:HQ_FILEDIALOGOPTYPE.SAVE,body:eventletXml,filetype:HQ_FILETYPE.EVENTLET};dialogService.getOpenDialogCallback()(HQ_DIALOG.SHARED_FILESAVELOAD,saveConfig)};$scope.restCallEventletXML(cbHaveXML)};$scope.restCallEventletXML=function(callback){var cbFetched=function(response){callback(response.xml)};var eventlet={composition:$scope.wizard.composition,sources:$scope.wizard.resources,settings:$scope.wizard.settings};for(var i=0;i<$scope.wizard.resources.length;i++){var resource=
$scope.wizard.resources[i];resource.sourceId=i;if(resource.transformations!=null&&resource.transformations.length==0)resource.transformations=null}restService.postEventletToXML(eventlet,cbFetched)};$scope.doHelp=function(){HQHelpDialogHelper.openHelp("eventletwizard")};$scope.doSettings=function(){if($scope.wizard.settings==null)$scope.wizard.settings={};dialogService.getOpenDialogCallback()(HQ_DIALOG.EVENTLETWIZARDSETTINGS,$scope.wizard.settings)};$scope.validate=function(){if($scope.wizard.resources.length==
0){$scope.step=1;dialogService.getOpenDialogCallback()(HQ_DIALOG.SHARED_ERRORALERT,{message:"Please select at least one CEP resource that provides data."});return false}if($scope.wizard.composition==null){$scope.step=2;dialogService.getOpenDialogCallback()(HQ_DIALOG.SHARED_ERRORALERT,{message:"Please correct the configuration details by entering all required information and according to the messages provided."});return false}return true}};function EventletWizardConfigChartController($scope){$scope.baseTypeDefault=HQ_CHARTBASETYPE.LINE;$scope.legendPlacementDefault=HQ_CHARTLEGENDPLACETYPE.NE;$scope.xaxisTypeDefault=HQ_CHARTAXISTYPE.DATETIME;$scope.xaxisPlacementDefault=HQ_CHARTXAXISPLACEMENTTYPE.BOTTOM;$scope.yaxisTypeDefault=HQ_CHARTAXISTYPE.LINEAR;$scope.yaxisPlacementDefault=HQ_CHARTYAXISPLACEMENTTYPE.LEFT;$scope.baseTypeItems=[HQ_CHARTBASETYPE.LINE,HQ_CHARTBASETYPE.COLUMN,HQ_CHARTBASETYPE.PIE,HQ_CHARTBASETYPE.AREA];$scope.seriesTypeItems=
$scope.baseTypeItems;$scope.legendPlacementItems=HQCollectionUtil.enumToArray(HQ_CHARTLEGENDPLACETYPE);$scope.axisTypeItems=HQCollectionUtil.enumToArray(HQ_CHARTAXISTYPE);$scope.xaxisPlacementItems=HQCollectionUtil.enumToArray(HQ_CHARTXAXISPLACEMENTTYPE);$scope.yaxisPlacementItems=HQCollectionUtil.enumToArray(HQ_CHARTYAXISPLACEMENTTYPE);$scope.markerTypeItems=HQCollectionUtil.enumToArray(HQ_CHARTMARKERTYPE);$scope.ready=false;$scope.seriesItems=[];$scope.cfg={type:$scope.baseTypeDefault,legendPlacement:$scope.legendPlacementDefault,
clickCallback:null,stack:false,opacity:null,xaxis:{type:$scope.xaxisTypeDefault,minimum:null,maximum:null,label:null,placement:$scope.xaxisPlacementDefault},yaxis:{type:$scope.yaxisTypeDefault,minimum:null,maximum:null,label:null,placement:$scope.yaxisPlacementDefault}};$scope.resourceItems=[];$scope.pointsources=[];$scope.eventTargetComputeComposition.addListener(HQ_EVENTTARGET_TYPE.EVENTLETWIZARDCOMPOSITION.name,function(){$scope.computeComposition()});$scope.eventTargetResourceDetailReady.addListener(HQ_EVENTTARGET_TYPE.EVENTLETWIZARDRESOURCES.name,
function(){$scope.applyResources()});$scope.computeComposition=function(){var chart=HQObjectUtil.copyObject($scope.cfg);chart.type=$scope.cfg.type.code;chart.stack=$scope.cfg.stack;chart.legendPlacement=$scope.cfg.legendPlacement.code;chart.xaxis.type=$scope.cfg.xaxis.type.code;chart.xaxis.placement=$scope.cfg.xaxis.placement.code;chart.yaxis.type=$scope.cfg.yaxis.type.code;chart.yaxis.placement=$scope.cfg.yaxis.placement.code;var seriesArray=[];var failedConfig=false;for(var i=0;i<$scope.seriesItems.length;i++){var series=
$scope.seriesItems[i];series.seriesErrorMessage=null;var opacityPattern=/^\d+.?\d*$/;if(HQStringUtil.isPopulated(series.opacity)&&series.opacity.match(opacityPattern)==null){series.seriesErrorMessage="Invalid opacity, requires a decimal between 0 and 1";failedConfig=true}var cfgseries={type:series.type.code,strokeWeight:series.strokeWeight,strokeColor:series.strokeColor,fillColor:series.fillColor,markerType:series.markerType==null?null:series.markerType.code,opacity:HQStringUtil.isPopulated(series.opacity)?
series.opacity:null,label:series.label!=null?series.label:"Series-"+(i+1)};cfgseries.pointsources=HQPushUtil.toCompositionPointSourceArray(series.pointsources,true);if(cfgseries.pointsources.length!=series.pointsources.length){series.seriesErrorMessage="Please populate all required fields marked by (*)";failedConfig=true}seriesArray.push(cfgseries)}var opacityPattern=/^\d+.?\d*$/;if(!HQStringUtil.isPopulated($scope.cfg.opacity)||$scope.cfg.opacity.match(opacityPattern)==null)chart.opacity=null;if(failedConfig){$scope.wizard.composition=
null;return}chart.data={series:seriesArray};$scope.wizard.composition={chart:chart}};$scope.applyResources=function(){$scope.ready=true;$scope.resourceItems=HQPushUtil.getResourceArraySelectable($scope.wizard.resources);$scope.seriesItems=[];if($scope.wizard.composition!=null&&$scope.wizard.composition.chart!=null){var existing=$scope.wizard.composition.chart;$scope.cfg=HQObjectUtil.copyObject(existing);$scope.cfg.type=HQCollectionUtil.getObjectValueInArrayWDefault($scope.baseTypeItems,"code",existing.type,
$scope.baseTypeDefault);$scope.cfg.stack=existing.stack;$scope.cfg.legendPlacement=HQCollectionUtil.getObjectValueInArrayWDefault($scope.legendPlacementItems,"code",existing.legendPlacement,$scope.legendPlacementDefault);$scope.cfg.xaxis.type=HQCollectionUtil.getObjectValueInArrayWDefault($scope.axisTypeItems,"code",existing.xaxis.type,$scope.xaxisTypeDefault);$scope.cfg.xaxis.placement=HQCollectionUtil.getObjectValueInArrayWDefault($scope.xaxisPlacementItems,"code",existing.xaxis.placement,$scope.xaxisPlacementDefault);
$scope.cfg.yaxis.type=HQCollectionUtil.getObjectValueInArrayWDefault($scope.axisTypeItems,"code",existing.yaxis.type,$scope.yaxisTypeDefault);$scope.cfg.yaxis.placement=HQCollectionUtil.getObjectValueInArrayWDefault($scope.yaxisPlacementItems,"code",existing.yaxis.placement,$scope.yaxisPlacementDefault);var existingSeries=existing.data.series;for(var i=0;i<existingSeries.length;i++){var series=HQObjectUtil.copyObject(existingSeries[i]);series.pointsources=[];HQPushUtil.applyPointsources(series.pointsources,
existingSeries[i].pointsources,$scope.resourceItems,$scope.resourceDetails,true);series.type=HQCollectionUtil.getObjectValueInArrayWDefault($scope.seriesTypeItems,"code",series.type,$scope.cfg.type);series.markerType=HQCollectionUtil.getObjectValueInArrayWDefault($scope.markerTypeItems,"code",series.markerType,null);$scope.seriesItems.push(series)}}if($scope.seriesItems.length==0)$scope.doSeriesAddItem()};$scope.doSeriesAddItem=function(){var ps=HQPushUtil.getDefaultPointsource($scope.resourceItems,
$scope.resourceDetails,true);var series={pointsources:[ps],type:$scope.cfg.type};$scope.seriesItems.push(series)};$scope.doSeriesRemoveItem=function(index){$scope.seriesItems.splice(index,1)};$scope.doPointsourceAddItem=function(index){var ps=HQPushUtil.getDefaultPointsource($scope.resourceItems,$scope.resourceDetails,true);$scope.seriesItems[index].pointsources.push(ps)};$scope.doPointsourceRemoveItem=function(seriesIndex,psIndex){$scope.seriesItems[seriesIndex].pointsources.splice(psIndex,1)};$scope.doPointsourceSelectedResource=
function(seriesIndex,psIndex){var ps=$scope.seriesItems[seriesIndex].pointsources[psIndex];ps.properties=HQPushUtil.getPropertyArraySelectable(ps.resourceItem,$scope.resourceDetails)};$scope.doPointsourceSelectedXProperty=function(seriesIndex,psIndex){var ps=$scope.seriesItems[seriesIndex].pointsources[psIndex];ps.propertyName=null};$scope.doPointsourceChangedXPropertyName=function(seriesIndex,psIndex){var ps=$scope.seriesItems[seriesIndex].pointsources[psIndex];ps.property=null};$scope.doPointsourceSelectedYProperty=
function(seriesIndex,psIndex){var ps=$scope.seriesItems[seriesIndex].pointsources[psIndex];ps.y_propertyName=null};$scope.doPointsourceChangedYPropertyName=function(seriesIndex,psIndex){var ps=$scope.seriesItems[seriesIndex].pointsources[psIndex];ps.y_property=null}};function EventletWizardConfigGaugeController($scope){$scope.resourceItems=[];$scope.pointsources=[];$scope.pointsourcesErrorMsg=null;$scope.cfg={caption:"",minimum:0,maximum:100,yellowFrom:75,yellowTo:89,redFrom:90,redTo:100,clickCallback:null,minorTicks:null,majorTicks:null,size:null};$scope.eventTargetComputeComposition.addListener(HQ_EVENTTARGET_TYPE.EVENTLETWIZARDCOMPOSITION.name,function(){$scope.computeComposition()});$scope.eventTargetResourceDetailReady.addListener(HQ_EVENTTARGET_TYPE.EVENTLETWIZARDRESOURCES.name,
function(){$scope.applyResources()});$scope.computeComposition=function(){var gauge=HQObjectUtil.copyObject($scope.cfg);gauge.pointsources=HQPushUtil.toCompositionPointSourceArray($scope.pointsources,false);$scope.pointsourcesErrorMsg=null;if(gauge.pointsources.length!=$scope.pointsources.length){$scope.pointsourcesErrorMsg="Please populate all required fields";$scope.wizard.composition=null;return}$scope.wizard.composition={gauge:gauge}};$scope.applyResources=function(){$scope.resourceItems=HQPushUtil.getResourceArraySelectable($scope.wizard.resources);
$scope.pointsources=[];if($scope.pointsources.length==0)$scope.doAddPointsource();if($scope.wizard.composition!=null&&$scope.wizard.composition.gauge!=null){var existing=$scope.wizard.composition.gauge;HQPushUtil.applyPointsources($scope.pointsources,existing.pointsources,$scope.resourceItems,$scope.resourceDetails,false);HQObjectUtil.populatePropertyFromObjectOwned(existing,$scope.cfg)}};$scope.doAddPointsource=function(){var ps=HQPushUtil.getDefaultPointsource($scope.resourceItems,$scope.resourceDetails,
false);$scope.pointsources.push(ps)};$scope.doRemovePointsource=function(index){$scope.pointsources.splice(index,1)};$scope.doSelectedResource=function(index){var ps=$scope.pointsources[index];ps.properties=HQPushUtil.getPropertyArraySelectable(ps.resourceItem,$scope.resourceDetails)};$scope.doSelectedProperty=function(index){var ps=$scope.pointsources[index];ps.propertyName=null};$scope.doChangedPropertyName=function(index){var ps=$scope.pointsources[index];ps.property=null}};function EventletWizardConfigGridController($scope){$scope.nestTypeItems=[HQ_GRIDNESTINGTYPE.COLUMN,HQ_GRIDNESTINGTYPE.ROW,HQ_GRIDNESTINGTYPE.TAB];$scope.innermostItems=[HQ_GRIDINNERMOSTTYPE.APPENDTOP,HQ_GRIDINNERMOSTTYPE.APPENDEND,HQ_GRIDINNERMOSTTYPE.LASTVALUE];$scope.nesting=false;$scope.nestingItems=[];$scope.nestingErrorMsg=null;$scope.inplace=false;$scope.inplaceItems=[];$scope.innermost=HQ_GRIDINNERMOSTTYPE.APPENDTOP;$scope.inplaceErrorMsg=null;$scope.cfg={displayTime:true,displaySource:true,
displayRowNum:true,displayEventNum:false,displayUpdNum:false,clickCallback:null};$scope.resourceItems=[];$scope.pointsources=[];$scope.eventTargetComputeComposition.addListener(HQ_EVENTTARGET_TYPE.EVENTLETWIZARDCOMPOSITION.name,function(){$scope.computeComposition()});$scope.eventTargetResourceDetailReady.addListener(HQ_EVENTTARGET_TYPE.EVENTLETWIZARDRESOURCES.name,function(){$scope.applyResources()});$scope.computeComposition=function(){var grid=HQObjectUtil.copyObject($scope.cfg);grid.atomicType=
$scope.inplace?"inplace":$scope.innermost.code;var nestedPS=HQPushUtil.toCompositionPointSourceArray($scope.nestingItems,false);var i,item,ckeys=[];$scope.nestingErrorMsg=null;if($scope.nesting){for(i=0;i<$scope.nestingItems.length;i++){item=$scope.nestingItems[i];ckeys.push({nestingType:item.nestType.code,pointsources:[nestedPS[i]]})}if(nestedPS.length!=$scope.nestingItems.length){$scope.nestingErrorMsg="Please populate all required fields";$scope.wizard.composition=null;return}}var inplacePS=HQPushUtil.toCompositionPointSourceArray($scope.inplaceItems,
false);$scope.inplaceErrorMsg=null;if($scope.inplace){for(i=0;i<$scope.inplaceItems.length;i++){item=$scope.inplaceItems[i];ckeys.push({nestingType:"inplace",pointsources:[inplacePS[i]]})}if(inplacePS.length!=$scope.inplaceItems.length){$scope.inplaceErrorMsg="Please populate all required fields";$scope.wizard.composition=null;return}}if(ckeys!=null)grid.ckeys=ckeys;$scope.wizard.composition={compositegrid:grid}};$scope.applyResources=function(){$scope.resourceItems=HQPushUtil.getResourceArraySelectable($scope.wizard.resources);
$scope.nestingItems=[];$scope.inplaceItems=[];if($scope.nestingItems.length==0)$scope.doNestingAddItem();if($scope.inplaceItems.length==0)$scope.doInplaceAddItem();if($scope.wizard.composition!=null&&$scope.wizard.composition.compositegrid!=null){var existing=$scope.wizard.composition.compositegrid;var i,ckey;if(existing.ckeys!=null&&existing.ckeys.length!=null){var pointsourcesNested=[];var pointsourcesInplace=[];var hasNesting=false;var hasInplace=false;for(i=0;i<existing.ckeys.length;i++){ckey=
existing.ckeys[i];if(HQCollectionUtil.findObjectValueInArray($scope.nestTypeItems,"code",ckey.nestingType)!=-1){pointsourcesNested.push(ckey.pointsources[0]);hasNesting=true}if(ckey.nestingType=="inplace"){pointsourcesInplace.push(ckey.pointsources[0]);hasInplace=true}}HQPushUtil.applyPointsources($scope.nestingItems,pointsourcesNested,$scope.resourceItems,$scope.resourceDetails,false);HQPushUtil.applyPointsources($scope.inplaceItems,pointsourcesInplace,$scope.resourceItems,$scope.resourceDetails,
false);for(i=0;i<existing.ckeys.length;i++){ckey=existing.ckeys[i];var index=HQCollectionUtil.findObjectValueInArray($scope.nestTypeItems,"code",ckey.nestingType);if(index!=-1)$scope.nestingItems[i].nestType=$scope.nestTypeItems[index]}$scope.nesting=hasNesting;$scope.inplace=hasInplace}HQObjectUtil.populatePropertyFromObjectOwned(existing,$scope.cfg);var indexInnermost=HQCollectionUtil.findObjectValueInArray($scope.innermostItems,"code",existing.atomicType);if(indexInnermost!=null)$scope.innermost=
$scope.innermostItems[indexInnermost]}};$scope.doNestingAddItem=function(){var ns=HQPushUtil.getDefaultPointsource($scope.resourceItems,$scope.resourceDetails,false);ns.nestType=HQ_GRIDNESTINGTYPE.COLUMN;$scope.nestingItems.push(ns)};$scope.doNestingRemoveItem=function(index){$scope.nestingItems.splice(index,1)};$scope.doNestingSelectedResource=function(index){var ns=$scope.nestingItems[index];ns.properties=HQPushUtil.getPropertyArraySelectable(ns.resourceItem,$scope.resourceDetails)};$scope.doNestingSelectedProperty=
function(index){var ns=$scope.nestingItems[index];ns.propertyName=null};$scope.doNestingChangedPropertyName=function(index){var ns=$scope.nestingItems[index];ns.property=null};$scope.doInplaceAddItem=function(){var ip=HQPushUtil.getDefaultPointsource($scope.resourceItems,$scope.resourceDetails,false);$scope.inplaceItems.push(ip)};$scope.doInplaceRemoveItem=function(index){$scope.inplaceItems.splice(index,1)};$scope.doInplaceSelectedResource=function(index){var ip=$scope.inplaceItems[index];ip.properties=
HQPushUtil.getPropertyArraySelectable(ip.resourceItem,$scope.resourceDetails)};$scope.doInplaceSelectedProperty=function(index){var ip=$scope.inplaceItems[index];ip.propertyName=null};$scope.doInplaceChangedPropertyName=function(index){var ip=$scope.inplaceItems[index];ip.property=null}};function EventletWizardConfigPluginController($scope){$scope.cfg={clickCallback:null,url:null,classname:null,configuration:null};$scope.errorMessage="";$scope.eventTargetComputeComposition.addListener(HQ_EVENTTARGET_TYPE.EVENTLETWIZARDCOMPOSITION.name,function(){$scope.computeComposition()});$scope.eventTargetResourceDetailReady.addListener(HQ_EVENTTARGET_TYPE.EVENTLETWIZARDRESOURCES.name,function(){$scope.applyResources()});$scope.computeComposition=function(){$scope.errorMessage=null;if(!HQStringUtil.isPopulated($scope.cfg.classname)){$scope.errorMessage=
"Please enter the JavaScript function";$scope.wizard.composition=null;return}var config=HQObjectUtil.copyObject($scope.cfg);$scope.wizard.composition={plugin:config}};$scope.applyResources=function(){if($scope.wizard.composition!=null&&$scope.wizard.composition.plugin!=null){var existing=$scope.wizard.composition.plugin;HQObjectUtil.populatePropertyFromObjectOwned(existing,$scope.cfg)}}};function EventletWizardConfigTimelineController($scope){$scope.resourceItems=[];$scope.pointsources=[];$scope.cfg={clickCallback:null};$scope.detailChoices=[HQ_TIMELINE_DISPLAY_TYPE.FULL,HQ_TIMELINE_DISPLAY_TYPE.SMALL,HQ_TIMELINE_DISPLAY_TYPE.TINY];$scope.detailChoice=HQ_TIMELINE_DISPLAY_TYPE.FULL;$scope.eventTargetComputeComposition.addListener(HQ_EVENTTARGET_TYPE.EVENTLETWIZARDCOMPOSITION.name,function(){$scope.computeComposition()});$scope.eventTargetResourceDetailReady.addListener(HQ_EVENTTARGET_TYPE.EVENTLETWIZARDRESOURCES.name,
function(){$scope.applyResources()});$scope.computeComposition=function(){var timeline=HQObjectUtil.copyObject($scope.cfg);timeline.detail=$scope.detailChoice.detail;timeline.pointsources=HQPushUtil.toCompositionPointSourceArray($scope.pointsources,false);$scope.wizard.composition={timeline:timeline}};$scope.applyResources=function(){$scope.resourceItems=HQPushUtil.getResourceArraySelectable($scope.wizard.resources);$scope.pointsources=[];if($scope.pointsources.length==0)$scope.doAddPointsource();
if($scope.wizard.composition!=null&&$scope.wizard.composition.timeline!=null){var existing=$scope.wizard.composition.timeline;HQPushUtil.applyPointsources($scope.pointsources,existing.pointsources,$scope.resourceItems,$scope.resourceDetails,false);HQObjectUtil.populatePropertyFromObjectOwned(existing,$scope.cfg);$scope.detailChoice=HQEnumUtil.findEnumValueWithDefault(HQ_TIMELINE_DISPLAY_TYPE,"detail",existing.detail,HQ_TIMELINE_DISPLAY_TYPE.FULL)}};$scope.doAddPointsource=function(){var ps=HQPushUtil.getDefaultPointsource($scope.resourceItems,
$scope.resourceDetails,false);$scope.pointsources.push(ps)};$scope.doRemovePointsource=function(index){$scope.pointsources.splice(index,1)};$scope.doSelectedResource=function(index){var ps=$scope.pointsources[index];ps.properties=HQPushUtil.getPropertyArraySelectable(ps.resourceItem,$scope.resourceDetails)};$scope.doSelectedProperty=function(index){var ps=$scope.pointsources[index];ps.propertyName=null};$scope.doChangedPropertyName=function(index){var ps=$scope.pointsources[index];ps.property=null}}
;function EventletWizardConfigurationController($scope,restService){$scope.resourceDetails=[];$scope.eventTargetResourceDetailReady=new EventTarget;$scope.eventTargetConfiguration.addListener(HQ_EVENTTARGET_TYPE.EVENTLETWIZARDCONFIG.name,function(){$scope.doReadConfig()});$scope.doReadConfig=function(){var cbFetched=function(response){$scope.resourceDetails=response.resourceDetails;$scope.eventTargetResourceDetailReady.fire(HQ_EVENTTARGET_TYPE.EVENTLETWIZARDRESOURCES.name)};$scope.resourceDetails.length=
$scope.wizard.resources.length;restService.postResources({resources:$scope.wizard.resources},cbFetched)};$scope.getConfigurationPartial=function(){if($scope.wizard.vistype==null)return HQUriUtil.getUrlViews(HQ_EVENTLET_TYPE.PLUGIN.configurl);return $scope.wizard.vistype.configurl}};function EventletWizardResourceSelectController($scope,restService,dialogService){$scope.parentRootDOM=$scope.rootDOM;$scope.endpoint={};$scope.engineURIs=[];$scope.engineURI={};$scope.resources=[];$scope.statementSelectionExpr=null;$scope.statementSelectionErrorMsg=null;$scope.onDemandQuery=null;$scope.onDemandQueryMaxRows=null;$scope.onDemandQueryErrorMsg=null;$scope.statementFilterExpr=null;var tablediv=HQJqueryUtil.findFirstChildElementUnderId($scope.rootDOM,"eventletwizard_resource_table");var tableConfig=
{"bSort":false};var cfg=HQTableUtil.getDefaultPlainDatatableConfig(tableConfig);$scope.resourceTable=tablediv.dataTable(cfg);if($scope.wizard.resources!=null){$scope.resources=$scope.wizard.resources;HQEventletWizardResourceSelectUtil.applyTableResources($scope)}var selectdiv=HQJqueryUtil.findElementById($scope.rootDOM,"eventletwizard_resource_tabs");selectdiv.tabs();$scope.endpoint=$scope.selectedEndpoint!=null?$scope.selectedEndpoint:HQEndpointUtil.getDefaultEndpoint($scope.endpoints);$scope.engineURIs=
$scope.endpoint.engines;$scope.engineURI=$scope.selectedEngineURI!=null?$scope.selectedEngineURI:HQEndpointUtil.getDefaultEngine($scope.endpoint);$scope.addSource=function(source){if(!HQCollectionUtil.findDuplicateJSON($scope.resources,source)){$scope.resources.push(source);HQEventletWizardResourceSelectUtil.applyTableResources($scope)}$scope.$parent.wizard.resources=$scope.resources};$scope.parentHandleVariableSelect=function(variableName){var sourceDesc={variable:{name:variableName,endpoint:$scope.endpoint.endpointName,
engineUri:$scope.engineURI.engineURI}};$scope.addSource(sourceDesc)};$scope.parentHandleStatementSelect=function(statementName){var sourceDesc={statement:{name:statementName,endpoint:$scope.endpoint.endpointName,engineUri:$scope.engineURI.engineURI}};if(HQStringUtil.isPopulated($scope.statementFilterExpr))sourceDesc.statement.filter=$scope.statementFilterExpr;$scope.addSource(sourceDesc)};$scope.parentHandleMetricsSelect=function(mtype){var sourceDesc={engineMetric:{name:mtype.code,endpoint:$scope.endpoint.endpointName,
engineUri:$scope.engineURI.engineURI}};$scope.addSource(sourceDesc)};$scope.doAddOnDemandQuery=function(){$scope.onDemandQueryErrorMsg=null;if(!HQStringUtil.isPopulated($scope.onDemandQuery)){$scope.onDemandQueryErrorMsg="Please provide a query";return}var sourceDesc={onDemandQuery:{query:$scope.onDemandQuery,maxRows:$scope.onDemandQueryMaxRows,endpoint:$scope.endpoint.endpointName,engineUri:$scope.engineURI.engineURI}};$scope.addSource(sourceDesc)};$scope.doAddStatementSelectionExpr=function(all){$scope.statementSelectionErrorMsg=
null;if(!all&&!HQStringUtil.isPopulated($scope.statementSelectionExpr)){$scope.statementSelectionErrorMsg="Please enter a selection expression";return}var sourceDesc={statementSet:{includes:all?null:$scope.statementSelectionExpr,endpoint:$scope.endpoint.endpointName,engineUri:$scope.engineURI.engineURI}};$scope.addSource(sourceDesc)};$scope.parentGetEndpointName=function(){return $scope.endpoint.endpointName};$scope.parentGetEngineURI=function(){return $scope.engineURI.engineURI};$scope.parentSetStatementSelectionExpression=
function(text){$scope.statementSelectionExpr=text};$scope.doConfigureResource=function(row_index){var html="\x3cdiv ng-app\x3d'myModule'/\x3e";var $div=$(html);var url=HQUriUtil.addUUIDToUrl(HQUriUtil.getUrlViews(HQ_DIALOG.EVENTLETWIZARDCONFIGURE.url));$div.load(url,function(response,status,xhr){if(!HQJqueryUtil.checkHandleLoadStatus(url,response,status,xhr))return;angular.bootstrap($div,["myModule"]);var settings={modal:false,title:HQ_DIALOG.EVENTLETWIZARDCONFIGURE.title,width:HQ_DIALOGDIMENSION_ENUM.POPUP.width,
height:HQ_DIALOGDIMENSION_ENUM.POPUP.height};var dialog=$div.dialog(settings);var closeButtonCallback=function(){dialog.dialog("close")};if($scope.resources[row_index].transformations==null)$scope.resources[row_index].transformations=[];var existingTransformations=$scope.resources[row_index].transformations;var applyCallback=function(iterate,transform){HQPushUtil.setIterateDesc($scope.resources[row_index],iterate);if(transform!=null)existingTransformations[0]=transform};angular.element($div.children(":first")).scope().doInitializeEventletWizardConfig(HQObjectUtil.copyObject(HQPushUtil.getIterateDesc($scope.resources[row_index])),
existingTransformations.length==0?null:HQObjectUtil.copyObject(existingTransformations[0]),closeButtonCallback,applyCallback,!HQPushUtil.isStatementSetSource($scope.resources[row_index]))})};$scope.getDefaultIterate=function(){return{now:true,realtime:true}};$scope.getDefaultTransform=function(){return{unmap:false}};$scope.doHandleEndpointSelect=function(){$scope.engineURIs=$scope.endpoint.engines;$scope.engineURI=HQEndpointUtil.getDefaultEngine($scope.engineURIs)}}
HQEventletWizardResourceSelectUtil=function(){};
HQEventletWizardResourceSelectUtil.applyTableResources=function($scope){var myarr=[],i,button;for(i=0;i<$scope.resources.length;i++){var sourceDesc=$scope.resources[i];var info=HQPushUtil.getResourceDetail(sourceDesc);myarr.push([HQStringUtil.emptyString(info.type),HQStringUtil.emptyString(info.name),HQStringUtil.emptyString(info.detail),HQStringUtil.emptyString(info.endpoint),HQStringUtil.emptyString(info.engineUri),'\x3cbutton class\x3d"wizard_configure" type\x3d"submit"\x3eConfigure\x3c/button\x3e'+'\x3cbutton class\x3d"wizard_delete" type\x3d"submit"\x3eDelete\x3c/button\x3e'])}$scope.resourceTable.fnClearTable();
$scope.resourceTable.fnAddData(myarr);var nodes=$scope.resourceTable.fnGetNodes();for(i=0;i<nodes.length;i++){var node=nodes[i];button=$(node).find("button.wizard_delete");(function(){var row_index=i;button.click(function(){$scope.resources.splice(row_index,1);HQEventletWizardResourceSelectUtil.applyTableResources($scope)})})();button=$(node).find("button.wizard_configure");(function(){var row_index=i;button.click(function(){$scope.doConfigureResource(row_index)})})()}};function EventletWizardResourceConfigureController($scope){$scope.iterate=null;$scope.iterateErrorMsg=null;$scope.iterateEnabled=true;$scope.transform=null;$scope.transformErrorMsg=null;$scope.closeCallback=null;$scope.applyCallback=null;$scope.doInitializeEventletWizardConfig=function(iterate,transform,closeCallback,applyCallback,iterateEnabled){$scope.iterate=iterate;$scope.iterateEnabled=iterateEnabled;if($scope.iterate==null)$scope.iterate={now:true,realtime:true};if(HQStringUtil.isPopulated($scope.iterate.pattern))$scope.iterate.isPattern=
true;$scope.transform={};if(transform!=null){var unmap=transform.unmap;$scope.transform={unmap:true,unmapPropertyName:unmap.property,keyName:unmap.key,keyType:unmap.keyType,valueName:unmap.value,valueType:unmap.valueType}}$scope.closeCallback=closeCallback;$scope.applyCallback=applyCallback;$scope.$apply()};$scope.doCancel=function(){$scope.closeCallback()};$scope.doClose=function(){if(!$scope.validate())return;$scope.closeCallback();var transformConfig=null;if($scope.transform.unmap)transformConfig=
{unmap:{property:$scope.transform.unmapPropertyName,key:$scope.transform.keyName,keyType:$scope.transform.keyType,value:$scope.transform.valueName,valueType:$scope.transform.valueType}};var iterate=null;if($scope.iterate.now!=true||$scope.iterate.realtime!=true||$scope.iterate.isPattern==true){iterate={now:$scope.iterate.now,realtime:$scope.iterate.realtime};if($scope.iterate.isPattern)iterate.pattern=$scope.iterate.pattern}$scope.applyCallback(iterate,transformConfig)};$scope.doHelp=function(){HQHelpDialogHelper.openHelp("eventletwizard-sourceinstruction")};
$scope.validate=function(){$scope.iterateErrorMsg=null;$scope.transformErrorMsg=null;if($scope.iterate.now!=true&&$scope.iterate.realtime!=true&&$scope.iterate.isPattern!=true){$scope.iterateErrorMsg="At least one of the choices must be checked";return false}if($scope.iterate.isPattern==true&&!HQStringUtil.isPopulated($scope.iterate.pattern)){$scope.iterateErrorMsg="Please provide a pattern";return false}if($scope.transform.unmap)if(!HQStringUtil.isPopulated($scope.transform.unmapPropertyName)||!HQStringUtil.isPopulated($scope.transform.keyName)||
!HQStringUtil.isPopulated($scope.transform.keyType)||!HQStringUtil.isPopulated($scope.transform.valueName)||!HQStringUtil.isPopulated($scope.transform.valueType)){$scope.transformErrorMsg="Please populate all unmap information";return false}return true}};function EventletWizardSettingsController($scope){$scope.closeCallback=null;$scope.retain={};$scope.menu=true;$scope.unitChoices=[HQ_RETAIN_TYPE.SECONDS,HQ_RETAIN_TYPE.MINUTES,HQ_RETAIN_TYPE.HOURS,HQ_RETAIN_TYPE.EVENTS];$scope.retainCountValid=true;$scope.settings=null;$scope.doInitialize=function(config){$scope.closeCallback=config.close;$scope.settings=config.config;if($scope.settings.retainCount==null||$scope.settings.retainUnit==null)$scope.retain.retainAll=true;else{$scope.retain.retainAll=false;
$scope.retain.retainCount=$scope.settings.retainCount;$scope.retain.retainEnum=HQEnumUtil.findEnumValue(HQ_RETAIN_TYPE,"unit",$scope.settings.retainUnit)}if($scope.settings.menu!=null)$scope.menu=$scope.settings.menu;$scope.$apply()};$scope.doOk=function(){if(!validateAndSet())return;$scope.closeCallback()};$scope.doCancel=function(){$scope.closeCallback()};$scope.doChangeRetainAll=function(){if($scope.retain.retainAll){$scope.retain.retainCount=null;$scope.retain.retainEnum=null}else $scope.retain.retainEnum=
HQ_RETAIN_TYPE.SECONDS};var validateAndSet=function(){$scope.settings.menu=$scope.menu;$scope.retainCountValid=true;if($scope.retain.retainAll){$scope.settings.retainCount=null;$scope.settings.retainUnit=null;return true}$scope.retainCountValid=HQValidationUtil.validateIntGreaterZero($scope.retain.retainCount);if($scope.retainCountValid){$scope.settings.retainCount=$scope.retain.retainCount;$scope.settings.retainUnit=$scope.retain.retainEnum.unit}return $scope.retainCountValid}};function PageBuilderController($scope,$compile,dialogService,$window){$scope.fromChoices=HQCollectionUtil.enumToArray(HQ_PAGEBUILDERFROMTYPE);$scope.$rootDOM=null;$scope.$containerDOM=null;$scope.configDroppable={drop:function(event,ui){$scope.doHandleDrop(this,ui.draggable)},greedy:"true",accept:function(){return true}};$scope.configDraggable={helper:"clone",containment:"html"};$scope.rows=[{cells:[{span:12,content:"empty"}]}];$scope.rowsErrorMsg=null;$scope.doInitialize=function(dialog){$scope.$rootDOM=
dialog.root;$scope.$containerDOM=$(dialog.root).find("#pagebuilder_container");$(dialog.root).find(".pagebuilder-draggable").draggable($scope.configDraggable);$scope.makeDroppable()};$scope.doHelp=function(){HQHelpDialogHelper.openHelp("eventletdashboard")};$scope.doSave=function(){$scope.saveInternal(null)};$scope.doSaveAndLaunch=function(){var thewindow=$window;var saveCallback=function(path){var f=function(){var url=HQUriUtil.getUrlViews("vfs/"+path);HQWindowUtil.openNewWindowFullscreen(url,"Eventlet HTML "+
path,false)};setTimeout(f,1)};$scope.saveInternal(saveCallback)};$scope.saveInternal=function(saveCallback){var eventlets={};var i,j,row,cell,eventletKey;for(i=0;i<$scope.rows.length;i++){row=$scope.rows[i];for(j=0;j<row.cells.length;j++){cell=row.cells[j];if(cell.content=="eventlet"){eventletKey=getEventletKey(i,j);eventlets[eventletKey]=cell;if(!HQStringUtil.isPopulated(cell.eventletFromInput)){$scope.rowsErrorMsg="Please populate all required fields";return}}}}var html=$scope.buildHTML(eventlets);
var filename="page1."+HQ_FILETYPE.HTML.extension;var saveConfig={filename:filename,mode:HQ_FILEDIALOGOPTYPE.SAVE,body:html,filetype:HQ_FILETYPE.HTML,saveCallback:saveCallback};dialogService.getOpenDialogCallback()(HQ_DIALOG.SHARED_FILESAVELOAD,saveConfig)};$scope.doDeleteCell=function(rowindex,cellindex){var row=$scope.rows[rowindex];var cell=row.cells[cellindex];if(cell.content!="empty"){cell.content="empty";return}if(row.cells.length==1){$scope.rows.splice(rowindex,1);return}var span=row.cells[cellindex].span;
row.cells.splice(cellindex,1);if(cellindex==0)cell=row.cells[0];else if(cellindex==row.cells.length)cell=row.cells[row.cells.length-1];else cell=row.cells[cellindex];cell.span+=span};$scope.doHandleDrop=function(element,draggable){var $e=$(element);var id=draggable.attr("id");var rowindex=$e.attr("pb-rowindex");var cellindex=$e.attr("pb-cellindex");if(HQStringUtil.startsWith(id,"pagebuilder_drag_cell_")){var span=HQStringUtil.numericAfterPrefix(id,"pagebuilder_drag_cell_");$scope.doHandleDropCell(rowindex,
cellindex,span)}else if(id=="pagebuilder_drag_eventlet")$scope.doHandleDropEventlet(rowindex,cellindex);else if(id=="pagebuilder_drag_row")$scope.doHandleDropRow(rowindex,cellindex);else if(id=="pagebuilder_drag_text")$scope.doHandleDropText(rowindex,cellindex)};$scope.doHandleDropText=function(rowindex,cellindex){var cell=$scope.rows[rowindex].cells[cellindex];cell.content="text";$scope.$apply()};$scope.doHandleDropRow=function(rowindex,cellindex){$scope.rows.splice(rowindex+1,0,{cells:[{span:12,
content:"empty"}]});$scope.$apply();$scope.makeDroppable()};$scope.doHandleDropEventlet=function(rowindex,cellindex){var cell=$scope.rows[rowindex].cells[cellindex];cell.content="eventlet";cell.eventletFromChoice=HQ_PAGEBUILDERFROMTYPE.FILENAME;cell.eventletFromInput=null;cell.eventletCanChooseFile=true;$scope.$apply()};$scope.doHandleDropCell=function(rowindex,cellindex,addSpan){var existingSpan=$scope.rows[rowindex].cells[cellindex].span;if(existingSpan<2)return;if(existingSpan<=addSpan)addSpan=
Math.round(existingSpan/2);var spanSameCell=addSpan;var spanNewCell=existingSpan-addSpan;$scope.rows[rowindex].cells[cellindex].span=spanSameCell;$scope.rows[rowindex].cells.splice(cellindex+1,0,{span:spanNewCell,content:"empty"});$scope.$apply();$scope.makeDroppable()};$scope.makeDroppable=function(){$($scope.$rootDOM).find(".pagebuilder-cell").droppable($scope.configDroppable)};$scope.doEventletChoiceFile=function(cell){var selectCallback=function(choice){cell.eventletFromInput=choice;$scope.$apply()};
var config={mode:HQ_FILEDIALOGOPTYPE.SELECT,filetype:HQ_FILETYPE.EVENTLET,selectCallback:selectCallback};dialogService.getOpenDialogCallback()(HQ_DIALOG.SHARED_FILESAVELOAD,config)};$scope.doEventletChangeFromChoice=function(cell){cell.eventletFromInput=null;cell.eventletCanChooseFile=cell.eventletFromChoice==HQ_PAGEBUILDERFROMTYPE.FILENAME};$scope.buildHTML=function(eventlets){$scope.rowsErrorMsg=null;var $content=$("\x3cdiv\x3e\x3c/div\x3e");for(i=0;i<$scope.rows.length;i++){row=$scope.rows[i];
var $rowDiv=$("\x3cdiv\x3e\x3c/div\x3e");$rowDiv.appendTo($content);var $fluidDiv=$("\x3cdiv\x3e\x3c/div\x3e").attr("class","row-fluid");$fluidDiv.appendTo($rowDiv);for(j=0;j<row.cells.length;j++){cell=row.cells[j];var $cellDiv=$("\x3cdiv\x3e\x3c/div\x3e").attr("class","span"+cell.span);$cellDiv.appendTo($fluidDiv);if(cell.content=="eventlet"){eventletKey=getEventletKey(i,j);var $eventlet=$("\x3cdiv\x3e\x3c/div\x3e").attr("id",eventletKey);$eventlet.appendTo($cellDiv)}else if(cell.content=="text")if(HQStringUtil.isPopulated(cell.text))$cellDiv.append(cell.text)}}var $htmlWrapped=
wrapBody($content,"Launcher",eventlets);var xml=$htmlWrapped.html();var formatted=HQXMLUtil.formatXml(xml);return"\x3c!DOCTYPE html\x3e\r\n"+formatted};var wrapBody=function($content,title,eventlets){var $shell=$("\x3cpre\x3e\x3c/pre\x3e");var $html=$("\x3chtml\x3e\x3c/html\x3e");$html.appendTo($shell);var $head=$("\x3chead\x3e\x3c/head\x3e");$head.appendTo($html);$head.append($("\x3ctitle\x3e\x3c/title\x3e").text(title));var styles=["styles/release/vendor.css","styles/common.css","styles/eventlet.css"];
var i;for(i=0;i<styles.length;i++)$head.append($("\x3clink /\x3e").attr("rel","stylesheet").attr("href",HQ_ESPERHQAPP_URL+styles[i]));var scripts=["scripts/release/vendor.min.js","scripts/release/common.min.js","scripts/release/eventlet.min.js"];for(i=0;i<scripts.length;i++)$head.append($("\x3cscript /\x3e").attr("src",HQ_ESPERHQAPP_URL+scripts[i]));var newline="\r\n";var eventletCode=[];for(var key in eventlets){if(!eventlets.hasOwnProperty(key))continue;var input=eventlets[key].eventletFromInput;
var text='$("#'+key+'").eventlet( {';if(eventlets[key].eventletFromChoice==HQ_PAGEBUILDERFROMTYPE.FILENAME)text+=HQ_LAUNCHPARAMTYPE.EVENTLETFILENAME+': "'+input+'"';else if(eventlets[key].eventletFromChoice==HQ_PAGEBUILDERFROMTYPE.URL)text+=HQ_LAUNCHPARAMTYPE.EVENTLETURL+': "'+encodeURI(input)+'"';else text+=HQ_LAUNCHPARAMTYPE.EVENTLETXML+': "'+HQStringUtil.escapeHTML(input)+'"';text+="});"+newline;eventletCode.push(text)}var startEventletsFunction="  var startEventlets \x3d function() {"+newline;
for(i=0;i<eventletCode.length;i++)startEventletsFunction+="    "+eventletCode[i];startEventletsFunction+="  };"+newline;var initializerCode=startEventletsFunction+"  $.eventletLoad({success:startEventlets});"+newline+"  window.onbeforeunload\x3dfunction() {$.eventletUnload();};"+newline;var script="\nvar init \x3d function() {"+newline+initializerCode+"}"+newline;$head.append($("\x3cscript\x3e\x3c/script\x3e").attr("type","text/javascript").text(script));var $body=$("\x3cbody\x3e\x3c/body\x3e").attr("onload",
"init()");$body.appendTo($html);$content.appendTo($body);return $shell};var getEventletKey=function(rowNum,cellNum){return"eventlet__row_"+rowNum+"_cell_"+cellNum}};var HQ_METRIC_LINECHART_ROUTED={name:"Line chart : Routed events",desc:"Line chart over time showing number of sent, routed, internal and external events"};var HQ_METRIC_LINECHART_OUTPUTPERSTMT={name:"Line chart : Output per Stmt",desc:"Line chart over time showing output event count per statement"};var HQ_METRIC_LINECHART_FILTERPERTYPE={name:"Line chart : Filter Activity per Type",desc:"Line chart over time showing event count per type"};
var HQ_METRIC_GRID_FILTERPERTYPE={name:"Grid : Filter Activity per Type",desc:"Grid showing event count per type"};var HQ_METRIC_GRID_OUTPUTPERSTMT={name:"Grid : Output per Stmt",desc:"Grid showing output event count per statement"};var HQ_METRIC_GRID_ENGINEMETRICS={name:"Appended Grid : Engine Metrics",desc:"Key engine metrics in a log-style grid"};var HQ_METRIC_GAUGE_EVALUATEDCOUNT={name:"Gauge : Evaluated Event Count",desc:"A gauge displaying the current number of events per second evaluated"};
var HQ_METRIC_TIMELINE_ENGINEMETRICS={name:"Timeline : Engine Metrics",desc:"A timeline of engine metrics"};var HQ_METRIC_ALL=[HQ_METRIC_LINECHART_ROUTED,HQ_METRIC_LINECHART_OUTPUTPERSTMT,HQ_METRIC_LINECHART_FILTERPERTYPE,HQ_METRIC_GRID_FILTERPERTYPE,HQ_METRIC_GRID_OUTPUTPERSTMT,HQ_METRIC_GRID_ENGINEMETRICS,HQ_METRIC_GAUGE_EVALUATEDCOUNT,HQ_METRIC_TIMELINE_ENGINEMETRICS];
function PushEndpointBrowseController($scope,dialogService,restService){$scope.endpointName=null;$scope.info=null;$scope.sessionCurrTable=null;$scope.sessionHistTable=null;$scope.resourceCurrTable=null;$scope.resourceHistTable=null;$scope.subscriptionCurrTable=null;$scope.subscriptionHistTable=null;$scope.messageTable=null;$scope.auditTable=null;$scope.metrics=HQ_METRIC_ALL;$scope.metricChoice=HQ_METRIC_LINECHART_ROUTED;$scope.engines=[];$scope.engineChoice=null;$scope.doInitialize=function(dialog){HQJqueryUtil.findElementById(dialog.root,
"endpoint_monitoring_tabs").tabs();$scope.endpointName=dialog.config.endpointName;$scope.info=dialog.config.info;$scope.engines=dialog.config.engines;$scope.engineChoice=HQEndpointUtil.getDefaultEngine($scope.engines);$scope.sessionCurrTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"endpoint_currsessions_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));$scope.sessionHistTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"endpoint_histsessions_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));
$scope.resourceCurrTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"endpoint_currresources_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));$scope.resourceHistTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"endpoint_histresources_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));$scope.subscriptionCurrTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"endpoint_currsubscriptions_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));
$scope.subscriptionHistTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"endpoint_histsubscriptions_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));$scope.messageTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"endpoint_logmsg_table_div").dataTable({aaSorting:[[0,"desc"]]});$scope.auditTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"endpoint_audit_table_div").dataTable({aaSorting:[[0,"desc"]]});applyAll();$scope.$apply()};$scope.doRefresh=function(){cbFetched=
function(response){$scope.info=response;applyAll()};restService.fetchPushinfoEndpoint($scope.endpointName,cbFetched)};$scope.doHelp=function(){HQHelpDialogHelper.openHelp("pushmonitoring-endpoint")};$scope.doStatementMemoryUse=function(){var config={endpointName:$scope.endpointName,engineURI:$scope.engineChoice.engineURI};dialogService.getOpenDialogCallback()(HQ_DIALOG.STMTMEMORYBROWSE,config)};$scope.doOpen=function(){if($scope.engineChoice==null)alert("No engine found for selection");var endpointName=
$scope.endpointName;var engineURI=$scope.engineChoice.engineURI;var composition;var sources;var i,s1;if($scope.metricChoice==HQ_METRIC_LINECHART_ROUTED){composition={chart:getLineChartOverTime()};sources=getMetricSourceArray("enginemetrics",engineURI,endpointName);var names=["sendCount","evaluatedCount","routedInternalCount","routedExternalCount"];var labels=["sent","evaluated","internal","external"];for(i=0;i<names.length;i++){s1={type:"line",label:labels[i],pointsources:[{sourceId:0,x:"engineTimeMillis",
y:names[i],incremental:true}]};composition.chart.data.series.push(s1)}}else if($scope.metricChoice==HQ_METRIC_LINECHART_OUTPUTPERSTMT){composition={chart:getLineChartOverTime()};sources=getMetricSourceArray("stmtoutputmetrics",engineURI,endpointName);sources[0].transformations=[{unmap:{property:"entries",key:"Statement Name",keyType:"string",value:"Statement Output Count",valueType:"long"}}];s1={type:"line",pointsources:[{sourceId:0,x:HQ_BUILTIN_PROPERTIES_TYPE.EVENTARRIVALTIME.code,y:"Statement Output Count",
label:"Statement Name"}]};composition.chart.data.series.push(s1)}else if($scope.metricChoice==HQ_METRIC_LINECHART_FILTERPERTYPE){composition={chart:getLineChartOverTime()};sources=getMetricSourceArray("filtermetrics",engineURI,endpointName);sources[0].transformations=[{unmap:{property:"entries",key:"Event Type",keyType:"string",value:"Event Count",valueType:"long"}}];s1={type:"line",pointsources:[{sourceId:0,x:HQ_BUILTIN_PROPERTIES_TYPE.EVENTARRIVALTIME.code,y:"Event Count",label:"Event Type"}]};
composition.chart.data.series.push(s1)}else if($scope.metricChoice==HQ_METRIC_GRID_ENGINEMETRICS){composition={compositegrid:{atomicType:"appendtop"}};sources=getMetricSourceArray("enginemetrics",engineURI,endpointName)}else if($scope.metricChoice==HQ_METRIC_GRID_FILTERPERTYPE){composition={compositegrid:{atomicType:"inplace",ckeys:[{nestingType:"inplace",pointsources:[{x:"Event Type",sourceId:0}]}]}};sources=getMetricSourceArray("filtermetrics",engineURI,endpointName);sources[0].transformations=
[{unmap:{property:"entries",key:"Event Type",keyType:"string",value:"Event Count",valueType:"long"}}]}else if($scope.metricChoice==HQ_METRIC_GRID_OUTPUTPERSTMT){composition={compositegrid:{atomicType:"inplace",ckeys:[{nestingType:"inplace",pointsources:[{x:"Statement Name",sourceId:0}]}]}};sources=getMetricSourceArray("stmtoutputmetrics",engineURI,endpointName);sources[0].transformations=[{unmap:{property:"entries",key:"Statement Name",keyType:"string",value:"Statement Output Count",valueType:"long"}}]}else if($scope.metricChoice==
HQ_METRIC_GAUGE_EVALUATEDCOUNT){composition={gauge:{maximum:1E6,caption:"Eval Cnt",size:200}};sources=getMetricSourceArray("enginemetrics",engineURI,endpointName);composition.gauge.pointsources=[{x:"evaluatedCount",sourceId:0}];new Array}else if($scope.metricChoice==HQ_METRIC_TIMELINE_ENGINEMETRICS){composition={timeline:{}};sources=getMetricSourceArray("enginemetrics",engineURI,endpointName)}else throw new Error("Unknown built-in "+$scope.metricChoice);var cbFetched=function(response){var config=
{eventletName:$scope.metricChoice.name+" for endpoint "+endpointName+" and engine "+engineURI,eventletXml:response.xml};dialogService.getOpenDialogCallback()(HQ_DIALOG.EVENTLET,config)};var eventlet={composition:composition,sources:sources};restService.postEventletToXML(eventlet,cbFetched)};var applyAll=function(){applySessions($scope.sessionCurrTable,$scope.info.sessions);applySessions($scope.sessionHistTable,$scope.info.sessionsHistorical);applyResources($scope.resourceCurrTable,$scope.info.resources);
applyResources($scope.resourceHistTable,$scope.info.resourcesHistorical);applySubscriptions($scope.subscriptionCurrTable,$scope.info.subscriptions);applySubscriptions($scope.subscriptionHistTable,$scope.info.subscriptionsHistorical);HQAuditMessageTableUtil.applyLogMsg($scope.messageTable,$scope.info.auditLogs);applyAudit();reformatTimestamps($scope.info.stats)};var applySubscriptions=function(table,subscriptions){var myarr=[];for(var i=0;i<subscriptions.length;i++){var row=subscriptions[i];myarr.push([row["subscriptionId"],
row["sessionId"],row["resourceId"],HQStringUtil.emptyString(JSON.stringify(row["resource"])),row["state"]])}table.fnClearTable();table.fnAddData(myarr)};var applySessions=function(table,sessions){var myarr=[];for(var i=0;i<sessions.length;i++){var row=sessions[i];myarr.push([row["sessionId"],row["clientConnectionString"],HQDateUtil.printDate(row["createdDate"]),HQDateUtil.printDate(row["renewedDate"]),row["state"]])}table.fnClearTable();table.fnAddData(myarr)};var applyResources=function(table,resources){var myarr=
[];for(var i=0;i<resources.length;i++){var row=resources[i];myarr.push([row["resourceId"],JSON.stringify(row["logicalResource"]),row["state"]])}table.fnClearTable();table.fnAddData(myarr)};var applyAudit=function(){var logs=$scope.info.auditLogs;var myarr=[];for(var i=0;i<logs.length;i++){var row=logs[i];var item={};if(row.hasOwnProperty("sessionAudit"))item={taken:HQDateUtil.printDate(row.sessionAudit.time),audited:"Session",action:row.sessionAudit.action,id:row.sessionAudit.sessionId,detail:""};
else if(row.hasOwnProperty("resourceAudit"))item={taken:HQDateUtil.printDate(row.resourceAudit.time),audited:"Resource",action:row.resourceAudit.action,id:row.resourceAudit.resourceId,detail:""};else if(row.hasOwnProperty("subscriptionAudit"))item={taken:HQDateUtil.printDate(row.subscriptionAudit.time),audited:"Subscription",action:row.subscriptionAudit.action,id:row.subscriptionAudit.subscriptionId,detail:""};else if(row.hasOwnProperty("messageAudit"))item={taken:HQDateUtil.printDate(row.messageAudit.time),
audited:"Message",action:row.messageAudit.level,id:"",detail:row.messageAudit.message};else continue;myarr.push([item.taken,item.audited,item.action,item.id,item.detail])}$scope.auditTable.fnClearTable();$scope.auditTable.fnAddData(myarr)};var reformatTimestamps=function(stats){for(var i=0;i<stats.length;i++){var stat=stats[i];stat.totals.time=HQDateUtil.printDate(stat.totals.time);for(var j=0;j<stat.last.length;j++){var lastStat=stat.last[j];lastStat.time=HQDateUtil.printDate(lastStat.time)}}};var getLineChartOverTime=
function(){return{type:"line",xaxis:{type:"datetime"},yaxis:{type:"linear"},data:{series:[]}}};var getMetricSourceArray=function(metricName,engineURI,endpoint){return[{sourceId:"0",engineMetric:{name:metricName,engineUri:engineURI,endpoint:endpoint}}]}};function WebLayerBrowseController($scope,dialogService,restService){$scope.info=null;$scope.clientCurrTable=null;$scope.clientHistTable=null;$scope.activationCurrTable=null;$scope.activationHistTable=null;$scope.clientresourceTable=null;$scope.serverresourceCurrTable=null;$scope.serverresourceHistTable=null;$scope.statTable=null;$scope.stattotalTable=null;$scope.messageTable=null;$scope.auditTable=null;$scope.doInitialize=function(dialog){HQJqueryUtil.findElementById(dialog.root,"weblayer_monitoring_tabs").tabs();
$scope.info=dialog.config.info;$scope.clientCurrTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"currclients_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));$scope.clientHistTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"histclients_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));$scope.activationCurrTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"curractivations_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));
$scope.activationHistTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"histactivations_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));$scope.clientresourceTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"clientresources_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));$scope.serverresourceCurrTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"currserverresources_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));
$scope.serverresourceHistTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"histserverresources_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));$scope.statTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"stats_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));$scope.stattotalTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"stattotal_table_div").dataTable(HQTableUtil.getDefaultFullDatatableConfig({}));$scope.messageTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,
"logmsg_table_div").dataTable({aaSorting:[[0,"desc"]]});$scope.auditTable=HQJqueryUtil.findFirstChildElementUnderId(dialog.root,"audit_table_div").dataTable({aaSorting:[[0,"desc"]]});applyAll();$scope.$apply()};$scope.doRefresh=function(){cbFetched=function(response){$scope.info=response;applyAll()};restService.fetchPushinfoClient(cbFetched)};$scope.doHelp=function(){HQHelpDialogHelper.openHelp("pushmonitoring-weblayer")};var applyAll=function(){applyClient($scope.clientCurrTable,$scope.info.clients);
applyClient($scope.clientHistTable,$scope.info.clientsHistorical);applyActivations($scope.activationCurrTable,$scope.info.clientActivations);applyActivations($scope.activationHistTable,$scope.info.clientActivationsHistorical);applyClientResources();applyServerResources($scope.serverresourceCurrTable,$scope.info.serverSubscriptions);applyServerResources($scope.serverresourceHistTable,$scope.info.serverSubscriptionsHistorical);applyStats();HQAuditMessageTableUtil.applyLogMsg($scope.messageTable,$scope.info.auditLogs);
applyAudit()};var applyClient=function(table,clients){var myarr=[];for(var i=0;i<clients.length;i++){var row=clients[i];myarr.push([row["clientId"],HQDateUtil.printDate(row["createdDate"]),HQDateUtil.printDate(row["openedDate"]),HQDateUtil.printDate(row["closedDate"]),HQDateUtil.printDate(row["deletedDate"]),row["browser"],HQStringUtil.emptyString(row["remoteAddress"]),HQStringUtil.emptyString(row["secure"]),row["state"]])}table.fnClearTable();table.fnAddData(myarr)};var applyActivations=function(table,
activations){var myarr=[];for(var i=0;i<activations.length;i++){var row=activations[i];myarr.push([row["clientId"],row["activationId"],HQDateUtil.printDate(row["activatedDate"]),row["activationName"],HQStringUtil.escapeHTML(row["activationXML"]),row["state"]])}table.fnClearTable();table.fnAddData(myarr)};var applyClientResources=function(){var table=$scope.clientresourceTable;var resources=$scope.info.clientActivationResources;var myarr=[];for(var i=0;i<resources.length;i++){var row=resources[i];
myarr.push([row["clientId"],row["activationId"],HQDateUtil.printDate(row["activatedDate"]),row["endpointName"],row["resourceId"],JSON.stringify(row["resource"]),row["subscriptionId"]])}table.fnClearTable();table.fnAddData(myarr)};var applyServerResources=function(table,resources){var myarr=[];for(var i=0;i<resources.length;i++){var row=resources[i];myarr.push([row["endpointName"],row["subscriptionId"],row["resourceId"],JSON.stringify(row["resource"]),HQDateUtil.printDate(row["subscribedDate"]),HQDateUtil.printDate(row["unsubscribedDate"]),
row["state"]])}table.fnClearTable();table.fnAddData(myarr)};var applyStats=function(){var row=$scope.info.statTotals;var totals=[HQDateUtil.printDate(row["lastUpdateDate"]),row["numMsg"],row["numLogicalMsg"],row["eventMessages"],row["newEvents"],row["manifests"]];$scope.stattotalTable.fnClearTable();$scope.stattotalTable.fnAddData([totals]);var table=$scope.statTable;var stats=$scope.info.statsPerClient;var myarr=[];for(var i=0;i<stats.length;i++){row=stats[i];myarr.push([row["clientId"],HQDateUtil.printDate(row["lastUpdateDate"]),
row["numMsg"],row["numLogicalMsg"],row["eventMessages"],row["newEvents"],row["manifests"]])}table.fnClearTable();table.fnAddData(myarr)};var applyAudit=function(){var logs=$scope.info.auditLogs;var myarr=[];for(var i=0;i<logs.length;i++){var row=logs[i];var item={};if(row.hasOwnProperty("clientAudit"))item={taken:HQDateUtil.printDate(row.clientAudit.time),audited:"Client",action:row.clientAudit.action,id:row.clientAudit.clientId,detail:""};else if(row.hasOwnProperty("messageAudit"))item={taken:HQDateUtil.printDate(row.messageAudit.time),
audited:"Message",action:row.messageAudit.level,id:"",detail:row.messageAudit.message};else if(row.hasOwnProperty("activationAudit"))item={taken:HQDateUtil.printDate(row.activationAudit.time),audited:"Activation",action:row.activationAudit.action,id:"Client "+row.activationAudit.clientId+" Activation "+row.activationAudit.activationId,detail:""};else if(row.hasOwnProperty("subscriptionAudit"))item={taken:HQDateUtil.printDate(row.subscriptionAudit.time),audited:"Server Resource",action:row.subscriptionAudit.action,
id:"Endpoint "+row.subscriptionAudit.endpointName+" Subscription "+row.subscriptionAudit.subscriptionId,detail:""};else continue;myarr.push([item.taken,item.audited,item.action,item.id,item.detail])}$scope.auditTable.fnClearTable();$scope.auditTable.fnAddData(myarr)}};